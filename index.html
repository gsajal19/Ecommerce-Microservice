<!DOCTYPE html>
<html>
<head>
  <title>Test Razorpay Payment</title>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>
  <h1>Razorpay Test Checkout</h1>
  <button id="payButton">Pay Now</button>

  <script>
    document.getElementById("payButton").onclick = async function () {
      try {
        // Step 1: Call your backend to get Razorpay order data
        const userId = "7a61d595-0b87-4089-9c32-6fbd02934c05"; // change as needed
        const response = await fetch(`localhost:8084/order/place-order?userid=7a61d595-0b87-4089-9c32-6fbd02934c05`, {
          method: "GET"
        });

        if (!response.ok) throw new Error("Failed to create order");

        const razorpayOrder = await response.json(); // get Razorpay order JSON

        console.log("Received Razorpay Order:", razorpayOrder);

        // Step 2: Configure Razorpay Checkout
        const options = {
          key: "rzp_test_XXXXXXXX", // Your Razorpay Test Key (public)
          amount: razorpayOrder.amount, // Amount in paise (â‚¹1 = 100)
          currency: razorpayOrder.currency,
          name: "E-Commerce Site",
          description: "Test Transaction",
          image: "https://yourdomain.com/logo.png", // Optional
          order_id: razorpayOrder.id,
          handler: async function (paymentResponse) {
            // Step 3: Send paymentResponse to your backend for signature verification
            console.log("Payment Success", paymentResponse);

            const verifyResponse = await fetch("http://localhost:8085/payment/verify", {
              method: "POST",
              headers: {
                "Content-Type": "application/json"
              },
              body: JSON.stringify({
                orderId: paymentResponse.razorpay_order_id,
                paymentId: paymentResponse.razorpay_payment_id,
                signature: paymentResponse.razorpay_signature
              })
            });

            const result = await verifyResponse.text(); // or json()
            alert("Payment verification result: " + result);
          },
          prefill: {
            name: "John Doe",
            email: "johndoe@example.com",
            contact: "9999999999"
          },
          theme: {
            color: "#3399cc"
          }
        };

        const rzp = new Razorpay(options);
        rzp.open();
      } catch (err) {
        console.error("Payment initiation error:", err);
        alert("Payment failed: " + err.message);
      }
    };
  </script>
</body>
</html>
